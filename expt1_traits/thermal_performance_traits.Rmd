---
title: "Thermal performance: CFUs and growth curves time-to-detection analyses"
author: "Hermina and Anjaney"
Date: "2025-02-05"
output:
  html_document:
    df_print: paged
    code_folding: hide
    toc: true
    toc_float:
      smooth_scroll: false
  pdf_document:
    toc: true
---

# Introduction

This notebook is for analyzing the temperature growth curves data produced by Anjaney and Hermina, as well as the survival CFU data produced by Hermina. It summarizes the findings for publication. This notebook was created by copying the relevant sections from `Anjaney_analysis--hermina_redo.Rmd` and `plate_reader_calibration.Rmd`.

The goal is to describe the thermal niche of different *Pseudomonas* strains present in the Terrestrial Ecology lab of Maddy Thakur (University of Bern). The main question the experiments are trying to answer: Is there a relationship between a strain's growth (fast VS slow grower) and its thermal niche?

See the associated manuscript for more details. This notebook covers all analyses performed for Experiment I in the manuscript.

## The data

16 soil *Pseudomonas* strains were used in total (BSC001 - BSC010, BSC015, BSC019, CK101 - CK104), inoculated either from early exponential phase or from stationary phase.

There are 3 data sets which are integrated in this analysis:

1. Colony forming unit (CFU) data for all 16 strains growing at 28C, 35C, and 40C.

2. Growth curves inoculated in a 10-fold serial dilution at 6 different starting concentrations ($N_0$) and 4 different temperatures (25C, 30C, 35C, and 40C). The CFU data is integrated into this analysis because it is used to infer the OD-converted inoculum size for each strain x temperature combination.

3. Dilution series performed on both of the microspectrophotometers in our lab. This is used to integrate the CFU data with the OD data (see above).

All data files and protocols are associated with the above analyses are available in the folder and sub-folders where this file is found.

Before we get started, let's load all the R packages and list the versions for reproducibility of the entire environment:

```{r, loadEnv}
# load environment
library(tidyverse)
library(readxl) # for importing data directly from Excel sheet
library(broom) # for easy fitting of several lm's from the same df
library(Hmisc) # for calculating non-parametric bootstrap confidence intervals
library(AICcmodavg) # AIC comparison for survival CFU data

# this is a set of custom functions written by AHG:
source("H1_extract_data_fun_v3-1.R") # for getting the data into R from the default H1 txt export format

# print the complete info about packages and versions currently loaded in the environment:
sessionInfo()

# set theme for all plots
fave_theme <- theme_light() + # see other options at https://ggplot2.tidyverse.org/reference/ggtheme.html
  theme(text = element_text(size=15), # larger text size for titles & axes
        panel.grid.major = element_blank(), # remove major gridlines
        panel.grid.minor = element_blank()) # remove minor gridlines
theme_set(fave_theme)

# define a palette for plotting all 6 species
ALLsp_palette = palette.colors(8, palette = "R4")[2:7]
```

# Plate reader calibration for CFU-to-OD conversion

Analysis of data generated by following the protocol `OD Calibration to CFUs.docx`.

Fairly exhaustive calibrations were done for the microplate spectrophotometers (hereafter referred to generally as "plate readers" or specifically by the name of each instrument, BioTek Synergy H1 or Biotek Epoch2). Different *Pseudomonas* species were grown in different culture conditions (96-well microplate, tube, or Erlenmeyer), temperatures (25C or 40C), and culture phases (exponential or stationary). Then, dilution series were made. These were measured by spectrophotometer at 600nm (OD$_{600}$) and by CFU to get the calibration. There were a lot of inconsistencies; these are to be expected since OD measures the amount of scattered light, which depends in part on cell density but also on cell size, clumping, etc.

Anyway, I tried my best to estimate a calibration curve.

## Load & parse data

```{r, calib_load&baseline_ExpBSC015}
#####################################
# load the microplate OD data
#####################################
synergy.df <- read_excel("./data/calibration_spectrophotometers--22Feb24.xlsx", sheet="microplate H1") %>%
                pivot_longer(cols=`25_rep1`:`40_rep6`,
                                   names_to=c("Temp", "Rep"),
                                   names_pattern="(.*)_rep(.)",
                                   values_to="OD") # reorganize the shape of the dataframe
epoch.df <- read_excel("./data/calibration_spectrophotometers--22Feb24.xlsx", sheet="microplate Epoch") %>%
                pivot_longer(cols=`25_rep1`:`40_rep6`,
                                   names_to=c("Temp", "Rep"),
                                   names_pattern="(.*)_rep(.)",
                                   values_to="OD") # reorganize the shape of the dataframe

# load the microplate CFU data
plateCFU.df <- read_excel("./data/calibration_spectrophotometers--22Feb24.xlsx", sheet="microplate_CFU")

#####################################
# baseline subtract using the blanks as well as the bottom 3 lowest dilutions for each sample
#####################################

## check if there's any systematic trend in the baseline value
#baseline_trend <- rbind(synergy.df %>% add_column(machine="Synergy"), # combine the data from the 2 plate readers
#                        epoch.df %>% add_column(machine="Epoch")) %>%
#                    filter(Dilution < 5e-06) %>%                      # keep blanks & 3 lowest dilutions
#                      # get median value for each temperature & replicate
#                      select(-Dilution, -Sample) %>% group_by(Temp, Rep, machine) %>%
#                          summarise(medianBlankOD = median(OD, na.rm=TRUE),
#                                    ICR_lo = quantile(OD, probs=0.25),
#                                    ICR_hi = quantile(OD, probs=0.75))
#ggplot(baseline_trend, aes(x=Rep, y=medianBlankOD, colour=Temp)) +
#  facet_wrap(vars(machine), scales="free") +
#  geom_errorbar(aes(ymin=ICR_lo, ymax=ICR_hi), width=0.2) +
#  geom_point()
## there is NO systematic trend in the baseline value
#rm(baseline_trend)

# in this case it seems there's a difference in the baselines for different incubation temperatures, but only for the Epoch2...

# baseline everything in the same way as before
synergy.df <- inner_join(synergy.df %>% filter(Dilution < 5e-06) %>%
                            select(-Dilution, -Sample) %>% # get the blanks & calculate mean value for each Temp & Rep
                                group_by(Temp, Rep) %>% summarise(medianBlankOD = median(OD, na.rm=TRUE)),
                          synergy.df %>% filter(Dilution > 5e-06) # add the medianBlankOD back to the data without the samples used for blanking
                        ) %>% mutate(baselinedOD = OD-medianBlankOD)

epoch.df <- inner_join(epoch.df %>% filter(Dilution < 5e-06) %>%
                          select(-Dilution, -Sample) %>% # get the blanks & calculate mean value for each Temp & Rep
                              group_by(Temp, Rep) %>%
                                summarise(medianBlankOD = median(OD, na.rm=TRUE)),
                       epoch.df %>% filter(Dilution > 5e-06) # add the medianBlankOD back to the data without the samples used for blanking
                      ) %>% mutate(baselinedOD = OD-medianBlankOD)


#####################################
# estimate the mean CFU of each sample
#####################################
plateCFU.df <- plateCFU.df %>% mutate(CFU_per_mL = `CFU per 100uL`/Dilution*10) %>%
                group_by(Sample, Phase, Incubation) %>%
                  summarise(meanCFU = mean(CFU_per_mL),
                            sdCFU = sd(CFU_per_mL))

# combine the CFU data with the OD data & infer the CFU for each dilution used in the OD data
synergy.df <- left_join(synergy.df, plateCFU.df) %>%
                mutate(inferred_meanDensity = meanCFU*Dilution,
                       inferred_sdDensity = sdCFU*Dilution) %>%
                  select(-meanCFU, -sdCFU)

epoch.df <- left_join(epoch.df, plateCFU.df) %>%
                mutate(inferred_meanDensity = meanCFU*Dilution,
                       inferred_sdDensity = sdCFU*Dilution) %>%
                  select(-meanCFU, -sdCFU)

# remove some of the data points because it seems we are hitting up against the limit of detection
synergy.df <- synergy.df %>% filter(inferred_meanDensity > 5e+04,
                                    baselinedOD > 5e-03,
                                    Temp==25) # drop the 40C because it looks even worse than 25C
# remove some of the data points because it seems we are hitting up against the limit of detection
epoch.df <- epoch.df %>% filter(inferred_meanDensity > 1e+04,
                           baselinedOD > 5e-03,
                           Temp==25) # again remove OD acquisition temp of 40C

# create columns for log10 values
synergy.df <- synergy.df %>%
                mutate(log10_OD = log10(baselinedOD),
                       log10_density = log10(inferred_meanDensity)) %>%
                 filter(log10_OD > -Inf)
epoch.df <- epoch.df %>%
              mutate(log10_OD = log10(baselinedOD),
                     log10_density = log10(inferred_meanDensity)) %>%
                 filter(log10_OD > -Inf)

# store the raw data
all_calib.data <- rbind(synergy.df %>% mutate(Detector="synergy"),
                        epoch.df %>% mutate(Detector="epoch")) %>% ungroup() %>%
                    select(-Rep, -medianBlankOD, -Dilution, -OD, -Temp) %>%
                      separate_wider_delim(Incubation, "C ", names=c("Incubation_temp", "Flask")) %>%
                        mutate(OD_temp=25)
all_calib.data$Incubation_temp <- as.numeric(all_calib.data$Incubation_temp)

rm(epoch.df, synergy.df, plateCFU.df)
```

Load additional data...

```{r, calib_load&baseline_Sta4sp}
# load the microplate OD data
synergy.df <- read_excel("./data/calibration_spectrophotometers--26Feb24.xlsx", sheet="microplate H1") %>%
                pivot_longer(cols =`rep1`:`rep6`,
                             names_to = "Rep",
                             names_pattern="rep(.)",
                             values_to="OD") %>% # reorganize the shape of the dataframe
                  mutate(OD_temp = 25)
epoch.df <- read_excel("./data/calibration_spectrophotometers--26Feb24.xlsx", sheet="microplate Epoch") %>%
              pivot_longer(cols =`rep1`:`rep6`,
                             names_to = "Rep",
                             names_pattern="rep(.)",
                             values_to="OD") %>% # reorganize the shape of the dataframe
                  mutate(OD_temp = 40)

# load the microplate CFU data
plateCFU.df <- read_excel("./data/calibration_spectrophotometers--26Feb24.xlsx", sheet="microplate_CFU")

# baseline subtract using the blanks as well as the bottom 1 lowest dilution for each sample

## check if there's any systematic trend in the baseline value
#baseline_trend <- rbind(synergy.df %>% add_column(machine="Synergy"), # combine the data from the 2 plate readers
#                        epoch.df %>% add_column(machine="Epoch")) %>%
#                    filter(Dilution < 1e-06) %>%                      # keep blanks & 3 lowest dilutions
#                      # get median value for each reader & replicate
#                      select(-Dilution, -Sample) %>% group_by(Rep, machine, Incubation) %>%
#                          summarise(medianBlankOD = median(OD, na.rm=TRUE),
#                                    ICR_lo = quantile(OD, probs=0.25, na.rm=TRUE),
#                                    ICR_hi = quantile(OD, probs=0.75, na.rm=TRUE))
#ggplot(baseline_trend, aes(x=Rep, y=medianBlankOD, colour=Incubation)) +
#  facet_wrap(vars(machine), scales="free") +
#  geom_errorbar(aes(ymin=ICR_lo, ymax=ICR_hi), width=0.2) +
#  geom_point()
## yes, there is a trend. But only for the Epoch2 plate reader and 25C data...
#rm(baseline_trend)

# remove the first 5 replicates in the "25C plate" Epoch data
epoch.df <- rbind(epoch.df %>% filter(Incubation == "25C plate reader", Rep==6),
                  epoch.df %>% filter(Incubation == "40C plate reader", Rep<6))
# & remove the 6th replicate in the "40C plate" Epoch data (that one is all NA's anyway)


# now, after excluding problematic values, baseline similarly to previous data:
synergy.df <- inner_join(synergy.df %>% filter(Dilution < 1e-06) %>%
                            select(-Dilution, -Sample) %>% # get the blanks & calculate mean value for each Temp & Rep
                                group_by(Rep, Incubation) %>% summarise(medianBlankOD = median(OD, na.rm=TRUE)),
                          synergy.df %>% filter(Dilution > 1e-06) # add the medianBlankOD back to the data without the samples used for blanking
                        ) %>% mutate(baselinedOD = OD-medianBlankOD)

epoch.df <- inner_join(epoch.df %>% filter(Dilution < 1e-06) %>%
                          select(-Dilution, -Sample) %>% # get the blanks & calculate mean value for each Temp & Rep
                              group_by(Rep, Incubation) %>% summarise(medianBlankOD = median(OD, na.rm=TRUE)),
                       epoch.df %>% filter(Dilution > 1e-06) # add the medianBlankOD back to the data without the samples used for blanking
                      ) %>% mutate(baselinedOD = OD-medianBlankOD)

# estimate the mean CFU of each sample
plateCFU.df <- plateCFU.df %>% mutate(CFU_per_mL = `CFU per 100uL`/Dilution*10) %>%
                group_by(Sample, Phase, Incubation) %>%
                  summarise(meanCFU = mean(CFU_per_mL),
                            sdCFU = sd(CFU_per_mL))

# combine the CFU data with the OD data & infer the CFU for each dilution used in the OD data
synergy.df <- left_join(synergy.df, plateCFU.df) %>%
                mutate(inferred_meanDensity = meanCFU*Dilution,
                       inferred_sdDensity = sdCFU*Dilution) %>%
                  select(-meanCFU, -sdCFU)

epoch.df <- left_join(epoch.df, plateCFU.df) %>%
                mutate(inferred_meanDensity = meanCFU*Dilution,
                       inferred_sdDensity = sdCFU*Dilution) %>%
                  select(-meanCFU, -sdCFU)

# remove some of the data points because it seems we are hitting up against the limit of detection
synergy.df <- rbind(synergy.df %>% filter(Sample=="BSC004", baselinedOD > 1e-02),
                    synergy.df %>% filter(Sample=="BSC008", Incubation=="25C plate reader", baselinedOD > 2e-02),
                    synergy.df %>% filter(Sample=="BSC008", Incubation=="40C plate reader", baselinedOD > 5e-02),
                    synergy.df %>% filter(Sample=="BSC015", Incubation=="25C plate reader", baselinedOD > 2e-02),
                    synergy.df %>% filter(Sample=="BSC015", Incubation=="40C plate reader", baselinedOD > 1e-02),
                    synergy.df %>% filter(Sample=="CK101", baselinedOD > 2e-02))
# remove the most concentrated samples because of violation of the Beer-Lambert law
synergy.df <- synergy.df %>% filter(baselinedOD < 1.4)

# remove some of the data points because it seems we are hitting up against the limit of detection
epoch.df <- rbind(epoch.df %>% filter(Sample %in% c("BSC004", "BSC008"), Incubation=="25C plate reader", baselinedOD > 5e-03),
                  epoch.df %>% filter(Sample %in% c("BSC015", "CK101"), Incubation=="25C plate reader", baselinedOD > 1e-02),
                  epoch.df %>% filter(Sample=="BSC015", Incubation=="40C plate reader", baselinedOD > 1e-02),
                  epoch.df %>% filter(Sample=="BSC008", Incubation=="40C plate reader", baselinedOD > 2e-02))
# remove the most concentrated samples because of violation of the Beer-Lambert law
epoch.df <- epoch.df %>% filter(baselinedOD < 1.1)


# get the log10 of the data
synergy.df <- synergy.df %>%
                mutate(log10_OD = log10(baselinedOD),
                       log10_density = log10(inferred_meanDensity)) %>%
                 filter(log10_OD > -Inf,
                        baselinedOD > 1e-13)

epoch.df <- epoch.df %>%
              mutate(log10_OD = log10(baselinedOD),
                     log10_density = log10(inferred_meanDensity)) %>%
                 filter(log10_OD > -Inf)

# store the raw data
temp.data <- rbind(synergy.df %>% mutate(Detector="synergy", OD_temp=25),
                   epoch.df %>% mutate(Detector="epoch", OD_temp=40)) %>% ungroup() %>%
               select(-Rep, -medianBlankOD, -Dilution, -OD) %>%
                 separate_wider_delim(Incubation, "C ", names=c("Incubation_temp", "Flask"))
temp.data$Incubation_temp <- as.numeric(temp.data$Incubation_temp)
all_calib.data <- rbind(all_calib.data %>% mutate(Sample = "BSC015"),
                        temp.data)

rm(epoch.df, synergy.df, plateCFU.df, temp.data)
```
## Estimate CFU to OD conversion

Let's consider only bacteria grown in the microplate because this is most relevant to our experiments. Then, we're interested in averaging across the effects of temperature, species, and microplate reader. So let's simply use data from different temperatures, species, and readers to run a linear model where CFU is the independent variable and OD is the dependent.

```{r, calibration}
ggplot(all_calib.data %>% filter(Flask == "plate reader"),
       aes(x=inferred_meanDensity, y=baselinedOD, colour=Detector)) +
  geom_point() +
  scale_y_log10() +
  scale_x_log10() +
  labs(title = "inocula grown in microplate")

## rather arbitrarily pick a subset of the data for creating the conversion
conversion.data <- all_calib.data %>% filter(Flask == "plate reader") %>%
                      filter(Sample != "BSC004") # exclude right side outlier
# exclude left side outlier
conversion.data <- conversion.data[-which(conversion.data$Sample=="BSC015" & conversion.data$Incubation_temp==40 & conversion.data$Phase=="Stationary"),]

# plot the final data that will be used for the conversion estimate:
ggplot(conversion.data, # here in terms of species
       aes(x=inferred_meanDensity, y=baselinedOD, colour=Sample)) +
  geom_point() +
  scale_y_log10() +
  scale_x_log10() +
  labs(title = "data used for CFU to OD conversion")
# plot again in terms of the microplate reader
ggplot(conversion.data,
       aes(x=inferred_meanDensity, y=baselinedOD, colour=Detector)) +
  geom_point() +
  scale_y_log10() +
  scale_x_log10() +
  labs(title = "data used for CFU to OD conversion")
# and again in terms of incubation temperature
ggplot(conversion.data,
       aes(x=inferred_meanDensity, y=baselinedOD, colour=Incubation_temp)) +
  geom_point() +
  scale_y_log10() +
  scale_x_log10() +
  labs(title = "data used for CFU to OD conversion")

# a linear model with density as the predictor
CFU_to_OD.lm <- with(conversion.data,
                     lm(log10_OD ~ log10_density))
summary(CFU_to_OD.lm)

# a function to convert from CFU to OD
convert_CFU_to_OD <- function(CFU) {
  10^(coef(CFU_to_OD.lm)[1] + coef(CFU_to_OD.lm)[2]*log10(CFU))
}

# check what these predictions look like
some_CFU_vals <- seq(from=3.000e+00, to=4.362e+10, length.out=10)
pred_OD <- sapply(some_CFU_vals,
                  convert_CFU_to_OD)

ggplot(conversion.data,
       aes(x=inferred_meanDensity, y=baselinedOD)) +
  geom_point() +
  scale_y_log10() +
  scale_x_log10() +
  geom_line(data=data.frame(some_CFU_vals, pred_OD), aes(x=some_CFU_vals, y=pred_OD)) +
  labs(title = "checking CFU to OD conversion (line) against data (points)")

# clean up variables that will not be used in further analyses
rm(all_calib.data, conversion.data, pred_OD, some_CFU_vals)
```

# Analysis of CFU data

Sections I-II from protocols `High-throughput growth curves (exponential phase).docx` and `High-throughput growth curves (stationary phase).docx` where used to create the single-use inoculum 'shots'. Then, (within 2 months) these shots were plated for CFU estimation by following the protocol `colony forming units (CFU) 6x6 drop plating.docx`.

The CFU data is used to estimate the growth probability at different elevated temperatures (35C and 40C) as compared to normal lab culture conditions for soil bacteria (28C). It's also used in conjunction with the growth curve data to inform us about the starting concentration of cells in each replicate, as indicated in [Mytilinaios et al. 2015](https://doi.org/10.1111/jam.12695).

## Load & parse the data

```{r, CFU_data}
# load the raw data
CFUraw_survival <- read_excel("./data/CFU_data_2023-12-13.xlsx", sheet="Temp_survival")

# annotate the Samples with their species and strain information
annot.df <- data.frame(Sample = c("BSC001", "BSC002", "BSC003", "BSC004", "BSC005", "BSC006", "BSC007", "BSC008", "BSC009", "BSC010", "BSC015", "BSC019", "CK101", "CK102", "CK103","CK104"),
                       Species = c(rep("P. putida", 3), rep("P. veronii", 3), rep("P. knackmussii", 2), "P. plecoglossicida", rep("P. putida", 2), "P. grimontii", rep("P. protegens", 4)),
                       Strain = c("F1", "KT2440", "uwc 2", rep(NA, 3), "B13", "B14", NA, "mt-2 KT2440", "KT2440", NA, rep("Pf5", 2), rep("CHAO", 2)),
                       Species_in_Expt2 = c(rep(TRUE, 3), rep(TRUE, 3), rep(FALSE, 2), FALSE, rep(TRUE, 2), TRUE, rep(TRUE, 4)))

CFUraw_survival <- inner_join(CFUraw_survival, annot.df, by=c("Sample"))

# remove survival data where fewer than 15 cells were counted for the 28*C control condition
CFUraw_survival <- CFUraw_survival %>% filter(CFU_at_28 > 14)

# calculate the survival under the extreme temperatures as a fraction of the density at 28
CFUraw_survival <- CFUraw_survival %>% mutate(survival = CFU_at_stress/CFU_at_28) %>%
                      rename(Temp = Stress_Temp) # rename this column to avoid confusion below

# get mean and bootstrapped confidence intervals
CFU_survival.df <-  CFUraw_survival %>% group_by(Sample, Species, Strain, Temp, Inoculum, Species_in_Expt2) %>%
                       summarise(ci = list(mean_cl_boot(survival) %>% 
                          rename(mean_surviv=y, lwr_ci=ymin, upr_ci=ymax))) %>% unnest(cols = c(ci))

# clean up
rm(annot.df)
```

## Does stationary phase protect cells from heat?

Based on the classical microbiology literature, I would expect that stationary phase cultures would be more resistant to high temperatures as compared to exponential phase cultures. Let's check if there's a significant effect of the inoculum phase (i.e., exponential or stationary) on the CFU. To do this we will use a two-way ANOVA.

```{r, CFU_signif_innoculum}
# convert the columns of the independent variables to factors
CFUraw_survival$Temp <- as.factor(CFUraw_survival$Temp)
CFUraw_survival$Species <- as.factor(CFUraw_survival$Species)
CFUraw_survival$Inoculum <- as.factor(CFUraw_survival$Inoculum)

# do the anova
  # no interaction
survival.anova <- aov(survival ~ Inoculum + Species + Temp, data = CFUraw_survival)
  # interaction
survival.anova.ALLinteractions <- aov(survival ~ Inoculum * Species * Temp, data = CFUraw_survival)
# use AIC to select the preferred model
model.set <- list(survival.anova, survival.anova.ALLinteractions)
model.names <- c("two.way", "interaction")
aictab(model.set, modnames = model.names)

# display the results
summary(survival.anova.ALLinteractions)
#TukeyHSD(survival.anova.ALLinteractions) # don't print this because it's very long and not so meaningful

# clean up
rm(survival.anova, survival.anova.ALLinteractions, model.set, model.names)
```
So there's a very slight effect of inoculum phase, but this is definitely less important than the effect of species. In fact, it seems that the inoculum effect actually interacts with the species. Neat!


## Plot CFU data

```{r, CFU_plots}
# re-order the Species for appropriate colour plotting
CFU_survival.df$Species <- factor(CFU_survival.df$Species,
                                  levels=c("P. veronii", "P. grimontii", "P. plecoglossicida", "P. protegens", "P. knackmussii", "P. putida"))
# for appropriate labelling of the facet with degree symbol, create a factorial version of Temp
CFU_survival.df$temp_as_factor <- factor(CFU_survival.df$Temp)
levels(CFU_survival.df$temp_as_factor) <- c("thirtyfive", "forty")
# for plotting little skulls to emphasize lack of growth
CFU_survival.df$Shape <- ifelse(CFU_survival.df$mean_surviv==0, "\u2620", "\u25cf")
plot.CFU_survivalEXP <- CFU_survival.df %>% filter(Inoculum == "Exponential") %>%
                          arrange(Temp, Species)
plot.CFU_survivalSTA <- CFU_survival.df %>% filter(Inoculum == "Stationary") %>%
                          arrange(Temp, Species)

print("exponential phase plot below:")

# plot the exponential phase data with Temp as rows
#ggplot(CFU_survival.df %>% filter(Inoculum == "Exponential"),
#       aes(y=mean_surviv, x=Species, colour=Species)) +
#  facet_grid(temp_as_factor ~ .,
#             labeller = as_labeller(c(thirtyfive='35\u00b0C',
#                                      forty='40\u00b0C'))) +
#  geom_hline(yintercept = 1, colour="grey") +
#  geom_point(position = position_dodge2(width = 0.8, preserve = "single"), alpha=0.5, shape=plot.CFU_survivalEXP$Shape, size=3) +
#  geom_linerange(aes(ymin=lwr_ci, ymax=upr_ci), position = position_dodge2(width = 0.8, preserve = "single")) +
#  scale_colour_manual(values=ALLsp_palette) +
#  theme(axis.text.x=element_text(angle = 60, hjust = 0.95)) +
#  labs(y="Effect Size (CFU stress/CFU 28*C)") +
#  theme(strip.background = element_rect(fill = "white", colour="black"),
#        strip.text = element_text(color = "black"))

# plot the exponential phase data again but with Temp as columns
ggplot(CFU_survival.df %>% filter(Inoculum == "Exponential"),
       aes(y=mean_surviv, x=Species, colour=Species)) +
  facet_wrap(. ~ temp_as_factor,
             labeller = as_labeller(c(thirtyfive='35\u00b0C',
                                      forty='40\u00b0C'))) +
  geom_hline(yintercept = 1, colour="grey") +
  geom_point(position = position_dodge2(width = 1), alpha=0.5, shape=plot.CFU_survivalEXP$Shape, size=3) +
  geom_linerange(aes(ymin=lwr_ci, ymax=upr_ci), position = position_dodge2(width = 1)) +
  scale_colour_manual(values=ALLsp_palette) +
  theme(axis.text.x=element_text(angle = 60, hjust = 0.95)) +
  labs(y="Heat Growth ± 95% CI (heat CFU / 28\u00b0C CFU)") +
  theme(strip.background = element_rect(fill = "white", colour="black"),
        strip.text = element_text(color = "black"),
        #axis.title.y = element_text(size = 12),
        axis.text.x=element_blank())

print("stationary phase plot below:")
# plot the stationary phase data with Temp as columns
ggplot(CFU_survival.df %>% filter(Inoculum == "Stationary"),
       aes(y=mean_surviv, x=Species, colour=Species)) +
  facet_wrap(. ~ temp_as_factor,
             labeller = as_labeller(c(thirtyfive='35\u00b0C',
                                      forty='40\u00b0C'))) +
  geom_hline(yintercept = 1, colour="grey") +
  geom_point(position = position_dodge2(width = 1), alpha=0.5, shape=plot.CFU_survivalSTA$Shape, size=3) +
  geom_linerange(aes(ymin=lwr_ci, ymax=upr_ci), position = position_dodge2(width = 1)) +
  scale_colour_manual(values=ALLsp_palette) +
  theme(axis.text.x=element_text(angle = 60, hjust = 0.95)) +
  labs(y="Heat Growth ± 95% CI (heat CFU / 28\u00b0C CFU)") +
  theme(strip.background = element_rect(fill = "white", colour="black"),
        strip.text = element_text(color = "black"),
        #axis.title.y = element_text(size = 12),
        axis.text.x=element_blank())

# clean up
rm(plot.CFU_survivalEXP, plot.CFU_survivalSTA, CFUraw_survival)
```

# Analysis of growth curve

Analysis of data generated by following the protocols `High-throughput growth curves (exponential phase).docx` and `High-throughput growth curves (stationary phase).docx`.


This is a quick analysis of the data that uses a coarse-grained approximation of the time-to-detection (TTD) as a proxy of a strain's growth. Note that TTD is inversely related to growth rate: a fast growing strain will have a shorter TTD and a slow growing strain will have a longer TTD.
